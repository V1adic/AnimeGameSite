@{
    ViewData["Title"] = "Регистрация - Quiet Planet";
}

<section class="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#0A0014] to-[#1A0C2D] px-4" style="aspect-ratio: 16 / 9; background-image: url('/images/MainPage/cosmos1.jpg'); background-size: cover; background-position: center;">
    <meta charset="UTF-8">
    <script src="/js/sha256.min.js"></script>
    <script src="/js/BigInteger.min.js"></script>
    <script src="/js/script.js"></script>

    <script>

        function sanitizeInput(input) {
            const div = document.createElement('div');
            div.textContent = input;
            return div.innerHTML;
        }

        // Username validation
        function validateUsername(username) {
            const usernameRegex = /^[a-zA-Z0-9]{4,10}$/;
            if (!usernameRegex.test(username)) {
                return "Имя пользователя должно содержать 4-10 букв или цифр";
            }
            // Check for potential XSS
            if (username !== sanitizeInput(username)) {
                return "Недопустимые символы в имени пользователя";
            }
            return null;
        }

        // Password validation
        function validatePassword(password) {
            if (password.length < 8) {
                return "Пароль должен содержать минимум 8 символов";
            }
            if (!/[A-Z]/.test(password)) {
                return "Пароль должен содержать хотя бы одну заглавную букву";
            }
            if (!/[a-z]/.test(password)) {
                return "Пароль должен содержать хотя бы одну строчную букву";
            }
            if (!/[0-9]/.test(password)) {
                return "Пароль должен содержать хотя бы одну цифру";
            }
            // Check for potential XSS
            if (password !== sanitizeInput(password)) {
                return "Недопустимые символы в пароле";
            }
            return null;
        }

        function validate() {

            const username = document.getElementById("registerUsername").value;
            const password = document.getElementById("registerPassword").value;
            const resultDiv = document.getElementById('registerResult');

            // Validate username
            const usernameError = validateUsername(username);
            if (usernameError) {
                resultDiv.textContent = usernameError;
                return;
            }

            // Validate password
            const passwordError = validatePassword(password);
            if (passwordError) {
                resultDiv.textContent = passwordError;
                return;
            }

            register();
        }
    </script>

    <div class="bg-black bg-opacity-60 backdrop-blur-md p-8 rounded-2xl shadow-lg max-w-md w-full">
        <h1 class="text-3xl font-bold text-white mb-6 text-center font-['Merriweather']">Регистрация</h1>

        <input type="text" id="registerUsername" placeholder="Имя пользователя"
               class="w-full mb-4 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 rounded-md border border-purple-500/20 focus:outline-none focus:ring-2 focus:ring-primary" />

        <input type="password" id="registerPassword" placeholder="Пароль"
               class="w-full mb-6 px-4 py-3 bg-gray-800 text-white placeholder-gray-400 rounded-md border border-purple-500/20 focus:outline-none focus:ring-2 focus:ring-primary" />

        <button onclick="validate()" class="cta-button bg-primary hover:bg-opacity-90 text-white py-3 px-6 w-full rounded-button font-medium transition-all">
            Регистрация
        </button>

        <div id="registerResult" class="mt-4 text-center text-sm text-red-400"></div>

        <p class="mt-6 text-center text-gray-300">
            Уже есть аккаунт?
            <a href="/login" class="text-secondary hover:underline">Войдите</a>
        </p>
    </div>
</section>
